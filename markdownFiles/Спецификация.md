# ADSKUpdater — заполнение параметров модели

## Что делает плагин

- Автоматически заполняет параметры `Наименования` и `Количество` для элементов по шаблонам для групп  
  **«Категория + Маркировка типоразмера»**.
- Дополнительно может:
  - заполнить параметр этажа;
  - заполнить параметр группирования;
  - проставить имя системы (полное или сокращённое);
  - сформировать составное описание в отдельный параметр;
  - обработать универсальные семейства;
  - привести параметры изделий DKC к ADSK;
  - заполнить толщину стенки воздуховодов по Excel-таблице;
  - массово присвоить фиксированные значения параметрам;
  - скопировать значения из одного параметра в другой.

Все настройки сохраняются отдельно для каждого проекта и подгружаются при следующем запуске.

---

## Левая часть окна — «Настройки наименования групп»

1. **Выбор категории**
   - В блоке **«Выбор категории»** выберите строку *Категория + Маркировка*, с которой хотите работать.
   - Серым курсивом показываются группы, для которых сейчас нет элементов в модели.

2. **Параметры элемента**
   - В блоке **«Параметры элемента»** отображается список параметров выбранной группы.
   - Двойной щелчок по параметру добавляет его в шаблон наименования.

3. **Шаблон наименования**
   - В блоке **«Шаблон наименования»** каждая строка — это:
     - `Префикс` + значение параметра + `Суффикс`.
   - Кнопки **«↑»** и **«↓»** меняют порядок строк.
   - Внизу блока задаются:
     - правило расчёта количества;
     - параметр, из которого брать величину;
     - коэффициент и округление.

4. **Кнопка «Заполнить выбранные»**
   - Применяет шаблон ко **всем выбранным группам**.
   - Пересчитывает `Наименование` и `Количество` для элементов этих групп.

---

## Правая часть окна — «Глобальные настройки заполнения»

Здесь вы отмечаете, какие действия выполнять при заполнении.

- ==**Наименование и Количество**==
  - Включает/выключает использование шаблонов.
  - Укажите параметры для записи имени и количества  (по умолчанию `ADSK_Наименование` и `ADSK_Количество`).

- ==**Этаж**==
  - Заполняет параметр этажа (по умолчанию `ADSK_Этаж`).
  - Режим:
    - **«По уровням»** — по высоте элемента относительно уровней;
    - **«По объёму в файле КООРД»** — по координатным объёмам из модели КООРД.

- **==Группирование==**
  - Заполняет параметр (по умолчанию `ADSK_Группирование` для MEP-оборудования и сетей  
    (логическое объединение элементов в группы для спецификаций).

- ==**Имя системы**==
  - Записывает имя системы в общий параметр (по умолчанию `ИмяСистемы` и `ADSK_Система_Имя`):
    - **«по имени системы»** — Полное имя без повторений, отбрасывает данные после пробела.
    - **«по сокращению системы»** — копирует параметр системный параметр Сокращение системы из параметров типа системы.  Для раздела ВК

- ==**Составной параметр**==
  - Записывает сформированное наименование/описание в дополнительный параметр.
  - Укажите имя параметра, который нужно заполнять (по умолчанию `ФСК_Описание`)

	## **Когда элемент вообще не заполняется**

	1. Если в `ADSK_Наименование` есть текст `!Не учитывать`  
   → элемент полностью пропускается, `ФСК_Описание` не трогается.

	2. Если `ADSK_Количество` пустое или равно нулю  
   → в `ФСК_Описание` записывается строка  
   `!Не учитывается`.

	**Из чего собирается текст**

	Для каждого подходящего элемента (трубы, фитинги, арматура, оборудование, кабельные лотки, короба, светильники и т.п.) строка формируется так:

	1. Берутся параметры **самого элемента** (в таком порядке, только непустые):
	   - `ADSK_Наименование`
	   - `ADSK_Код изделия`
	   - `ADSK_Марка`
	   - `ADSK_Завод-изготовитель`

	1. Дополнительно для составных изделий берутся **подчинённые элементы** (вложенные семейства):
	   - Учитываются только те, у которых:
     - в `ADSK_Наименование` **нет** `!Не учитывать`;
     - `ADSK_Количество` пустое или равно `1`.
	   - Для каждого такого подэлемента добавляется фрагмент по той же схеме:
     - `ADSK_Наименование` + `ADSK_Код изделия` + `ADSK_Марка` + `ADSK_Завод-изготовитель`.

	1. Для некоторых категорий (прежде всего трубная арматура и фитинги) дополнительно пытается добавиться **размер**:
	   - сначала из системного `RBS_CALCULATED_SIZE` или параметров `Общий размер / Размер / Overall Size / Size`;
	   - если там не найдено — по диаметрам коннекторов (в футах, пересчитанных в мм);
	   - если есть несколько разных диаметров, формируется диапазон вида  
     `… 50 мм – 100 мм`.

	###### **Итоговая строка**

	- Все собранные куски склеиваются через пробел в одну строку.  
	- Если в итоге не набралось ни одного значения — в `ФСК_Описание` записывается пустая строка.

- ==**Универсальные семейства**==
  - Обрабатывает универсальные семейства (с префиксов _ У _ в названии семейства):
  - Переносит размеры/диаметры из служебных полей (Маска наименования, Маска марки и маска кода изделия) в соответствующие ADSK-параметры.

- ==**Параметры системы → элементы**==
  - Копирует значение параметров типа системы в параметры самих элементов системы. (`ADSK_Система_Классификация, ADSK_Номер секции, ADSK_Комплект` )
  - Для работы необходимо заполнить исходные данные в соответствующей ведомости в разделе "Системы"
- ==**Толщина стенки воздуховодов**==
  - По Excel-таблице заполняет толщину стенки воздуховодов
    в зависимости от материала, формы, изоляции и размера. 
  - Записывает рассчитанное значение толщины в общий параметр (по умолчанию `ADSK_Толщина стенки`)

- ==**Присвоить значения всем элементам**==
  - Список строк вида **«Значение → Параметр»**.
  - Каждая строка присваивает указанное значение этому параметру
    для всех элементов, где этот параметр существует.

- ==**Скопировать значения параметров**==
  - Список строк вида **«Источник → Приёмник»**.
  - Для каждого элемента значение из параметра-источника копируется
    в параметр-приёмник.
- ==**Блок ЭОМ / DKC**==
  - **«ADSK для DKC»** — копирует значения из параметров `DKC_*` в соответствующие `ADSK_*`
  - **«Смена производителя для лотков DKC»** — по Excel-файлу заменяет производителя
    и связанные значения для кабельных лотков DKC в параметра ADSK.
---

## Кнопки внизу

- **«Заполнить всё»**
  - Применяет шаблоны ко **всем группам**, где они настроены.
  - Выполняет все включённые глобальные действия (этаж, группирование, системы, DKC, Excel-правила, присвоение и копирование параметров).

- **«Заполнить фоново»**
  - Запускает сценарий фоновой обработки моделей через внешние скрипты.
  - Используется при пакетной обработке; в обычной работе можно не трогать.

Во время работы показывает прогресс и статус.  
После завершения в строке состояния внизу выводится список выполненных действий и количество успешно обработанных элементов.
